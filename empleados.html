<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Empleados</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    button { padding: 8px 16px; margin-top: 20px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Empleados</h2>
  <button id="generar-masivo">Generar cartas masivas</button>

  <table id="tabla-empleados">
    <thead>
      <tr>
        <th>Cédula</th>
        <th>Nombre</th>
        <th>Cargo</th>
        <th>Ingreso</th>
        <th>Salida</th>
        <th>Sueldo</th>
        <th>Razón</th>
      </tr>
    </thead>
    <tbody id="cuerpo-tabla"></tbody>
  </table>

  <script>
    async function cargarEmpleados() {
      try {
        const res = await fetch('/api/empleados');
        if (!res.ok) throw new Error('No se pudo cargar empleados');
        const empleados = await res.json();
        const cuerpo = document.getElementById('cuerpo-tabla');
        cuerpo.innerHTML = '';

        empleados.forEach(emp => {
          const fila = document.createElement('tr');
          fila.innerHTML = `
            <td>${emp.cedula}</td>
            <td>${emp.nombre}</td>
            <td>${emp.cargo}</td>
            <td>${emp.ingreso}</td>
            <td>${emp.egreso}</td>
            <td>${emp.sueldo}</td>
            <td>${emp.razon}</td>
          `;
          cuerpo.appendChild(fila);
        });
      } catch (err) {
        alert('Error al cargar empleados');
        console.error(err);
      }
    }

    document.getElementById('generar-masivo').addEventListener('click', async () => {
      const filas = document.querySelectorAll('#cuerpo-tabla tr');
      for (const fila of filas) {
        const celdas = fila.querySelectorAll('td');
        const datos = {
          cedula: celdas[0].textContent,
          nombre: celdas[1].textContent,
          cargo: celdas[2].textContent,
          ingreso: celdas[3].textContent,
          egreso: celdas[4].textContent,
          sueldo: celdas[5].textContent,
          razon: celdas[6].textContent
        };

        const res = await fetch('/api/generar-carta-html', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(datos)
        });

        const html = await res.text();
        const win = window.open('', '_blank');
        win.document.write(html);
        win.document.close();
      }
    });

    cargarEmpleados();
  </script>
</body>
</html>